<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Controller & Routes - Skinny Framework</title>
    <script type="text/javascript" src="//codeorigin.jquery.com/jquery-1.10.2.min.js"></script>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.1/css/bootstrap.min.css"/>
    <link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="container">
      <div class="row">
    <div class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="/">Skinny Framework</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="/documentation" class="dropdown-toggle" data-toggle="dropdown">Documentation&nbsp;<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/documentation/getting-started.html">Getting Started</a></li>
                <li><a href="/documentation/controller-and-routes.html">Controller & Routes</a></li>
                <li><a href="/documentation/validator.html">Validator</a></li>
                <li><a href="/documentation/view-templates.html">View Templates</a></li>
                <li><a href="/documentation/orm.html">O/R Mapper</a></li>
                <li><a href="/documentation/factory-girl.html">FactoryGirl</a></li>
                <li><a href="/documentation/db-migration.html">DB Migration</a></li>
                <li><a href="/documentation/tasks.html">Tasks</a></li>
                <li><a href="/documentation/testing.html">Testing</a></li>
              </ul>
            </li>
            <li><a href="https://github.com/skinny-framework/skinny-framework">Source</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
        <div class="col-xs-2">
          <div class="content small">
            <h5>Documentation</h5>
            <hr/>
            <p><a href="/documentation/getting-started.html">Getting Started</a></p>
            <p><a href="/documentation/controller-and-routes.html">Controller & Routes</a></p>
            <p><a href="/documentation/validator.html">Validator</a></p>
            <p><a href="/documentation/view-templates.html">View Templates</a></p>
            <p><a href="/documentation/orm.html">O/R Mapper</a></p>
            <p><a href="/documentation/factory-girl.html">FactoryGirl</a></p>
            <p><a href="/documentation/db-migration.html">DB Migration</a></p>
            <p><a href="/documentation/tasks.html">Tasks</a></p>
            <p><a href="/documentation/testing.html">Testing</a></p>
          </div>
        </div>
        <div class="col-xs-10">
          <div class="content">
<a href="https://github.com/skinny-framework/skinny-framework"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
            <h2>Controller &amp; Routes</h2>

<hr/>

<h3>Routing &amp; Controller</h3>

<p>Skinny&rsquo;s routing mechanism and controller layer on MVC architecture is a <strong>rich Scalatra</strong>. </p>

<p>Skinny&rsquo;s extension provides you much simpler/rich syntax. Of course, if you need to use Scalatra&rsquo;s API directly, Skinny never bothers you.</p>

<p><img alt="Scalatra" src="/images/scalatra.png" /></p>

<p><code>SkinnyController</code> is a trait which extends <code>ScalatraFilter</code> and out-of-the-box components are integrated.</p>
<pre class="highlight java"><span class="c1">// src/main/scala/controller/MembersController.scala</span>
<span class="kd">class</span> <span class="nc">MembersController</span> <span class="kd">extends</span> <span class="n">SkinnyController</span> <span class="o">{</span>
  <span class="n">protectFromForgery</span><span class="o">()</span> <span class="c1">// CSRF protection enabled</span>

  <span class="n">def</span> <span class="n">index</span> <span class="o">=</span> <span class="o">{</span>
    <span class="c1">// set 'members' in the request scope, then you can use it in views</span>
    <span class="n">set</span><span class="o">(</span><span class="s">&quot;members&quot;</span> <span class="o">-&gt;</span> <span class="n">Member</span><span class="o">.</span><span class="na">findAll</span><span class="o">())</span>
    <span class="n">render</span><span class="o">(</span><span class="s">&quot;/members/index&quot;</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="n">def</span> <span class="n">newOne</span> <span class="o">=</span> <span class="n">render</span><span class="o">(</span><span class="s">&quot;/members/new&quot;</span><span class="o">)</span>

  <span class="n">def</span> <span class="n">createForm</span> <span class="o">=</span> <span class="n">validation</span><span class="o">(</span><span class="n">params</span><span class="o">,</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">minLength</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">&quot;countryId&quot;</span><span class="o">)</span> <span class="n">is</span> <span class="n">numeric</span>
  <span class="o">)</span>

  <span class="n">def</span> <span class="n">createFormParams</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="na">permit</span><span class="o">(</span>
    <span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="n">ParamType</span><span class="o">.</span><span class="na">String</span><span class="o">,</span> 
    <span class="s">&quot;countryId&quot;</span> <span class="o">-&gt;</span> <span class="n">ParamType</span><span class="o">.</span><span class="na">Long</span><span class="o">)</span>

  <span class="n">def</span> <span class="n">create</span> <span class="o">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">createForm</span><span class="o">.</span><span class="na">validate</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">Member</span><span class="o">.</span><span class="na">createWithPermittedAttributes</span><span class="o">(</span><span class="n">createFormParams</span><span class="o">)</span>
    <span class="n">redirect</span><span class="o">(</span><span class="s">&quot;/members&quot;</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">render</span><span class="o">(</span><span class="s">&quot;/members/new&quot;</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// src/main/scala/controller/Controllers.scala</span>
<span class="n">object</span> <span class="n">Controllers</span> <span class="o">{</span>
  <span class="n">val</span> <span class="n">members</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MembersController</span> <span class="n">with</span> <span class="n">Routes</span> <span class="o">{</span>
    <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/?&quot;</span><span class="o">)(</span><span class="n">index</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">'</span><span class="n">index</span><span class="o">)</span>
    <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/new&quot;</span><span class="o">)(</span><span class="n">newOne</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">'</span><span class="k">new</span><span class="o">)</span>
    <span class="n">post</span><span class="o">(</span><span class="s">&quot;/members/?&quot;</span><span class="o">)(</span><span class="n">create</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">'</span><span class="n">create</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// src/main/scala/ScalatraBootstrap.scala</span>
<span class="kd">class</span> <span class="nc">ScalatraBootstrap</span> <span class="n">exntends</span> <span class="n">SkinnyLifeCycle</span> <span class="o">{</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">initSkinnyApp</span><span class="o">(</span><span class="nl">ctx:</span> <span class="n">ServletContext</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// register routes</span>
    <span class="n">Controllers</span><span class="o">.</span><span class="na">members</span><span class="o">.</span><span class="na">mount</span><span class="o">(</span><span class="n">ctx</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>
<p><code>#render</code> expects <code>src/main/webapp/WEB-INF/views/members/index.html.ssp</code> by default.</p>
<pre class="highlight text">render(&quot;/members/index&quot;)
</pre><pre class="highlight text">&lt;!-- src/main/webapp/WEB-INF/views/members/index.html.ssp --&gt;
&lt;%@val members: Seq[Member]%&gt;
&lt;ul&gt;
#for (member &lt;- members)
  &lt;li&gt;${member.name}&lt;/li&gt;
#end
&lt;ul&gt;
</pre>
<hr/>

<h4>SkinnyController &amp; SkinnyServlet</h4>

<p>There are two controller base trait. SkinnyController is a ScalatraFilter. SkinnyServlet is a ScalatraServlet.</p>

<ul>
<li><a href="(http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraFilter)">org.scalatra.ScalatraFilter</a></li>
<li><a href="(http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraServlet)">org.scalatra.ScalatraServlet</a></li>
</ul>

<p>Basically SkinnyController is more suitable for Skinny framework based applications.</p>

<p>However, really you need to use ScalatraServlet, use SkinnyServlet instead.</p>

<hr/>

<h3>SkinnyResource</h3>

<p>SkinnyResource is a useful base trait for RESTful web services. SkinnyResource is very similar to Rails ActiveResource.</p>

<p><a href="http://guides.rubyonrails.org/routing.html#resource-routing-the-rails-default">Resource Routing: the Rails Default (Rails Routing from the Outside In — Ruby on Rails Guides)</a></p>

<p><a href="https://github.com/rails/activeresource">https://github.com/rails/activeresource</a></p>

<p>SkinnyResource is also useful as a controller sample. If you&rsquo;re a Skinny beginner, take a look at its code.</p>

<p><a href="https://github.com/skinny-framework/skinny-framework/blob/master/framework/src/main/scala/skinny/controller/SkinnyResource.scala">framework/src/main/scala/skinny/controller/SkinnyResource.scala</a></p>

<p>SkinnyResourceActions has action methods for the resource and SkinnyResourceRoutes defines routings for the resource.
If you&rsquo;d like to customize routings (e.g. use only creation and deletion), just mixin only SkinnyResourceActions and define routings by yourself.</p>

<p>You can get SkinnyResource example by scaffolding.</p>
<pre class="highlight text">./skinny g scaffold members member name:String birthday:LocalDate
</pre>
<p>Then you get the following code. If you need to customize, override some parts of SkinnyResource:</p>

<p><a href="https://github.com/skinny-framework/skinny-framework/blob/master/framework/src/main/scala/skinny/controller/SkinnyResource.scala">framework/src/main/scala/skinny/controller/SkinnyResource.scala</a></p>
<pre class="highlight java"><span class="kn">package</span> <span class="n">controller</span>

<span class="kn">import</span> <span class="nn">skinny._</span>
<span class="kn">import</span> <span class="nn">skinny.validator._</span>
<span class="kn">import</span> <span class="nn">model.Member</span>

<span class="n">object</span> <span class="n">MembersController</span> <span class="kd">extends</span> <span class="n">SkinnyResource</span> <span class="o">{</span>
  <span class="n">protectFromForgery</span><span class="o">()</span> <span class="c1">// CSRF protection</span>

  <span class="n">override</span> <span class="n">def</span> <span class="n">model</span> <span class="o">=</span> <span class="n">Member</span> <span class="c1">// SkinnyModel for this controller</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">resourcesName</span> <span class="o">=</span> <span class="s">&quot;members&quot;</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">resourceName</span> <span class="o">=</span> <span class="s">&quot;member&quot;</span>

  <span class="c1">// parameters &amp; validations for creation</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">createForm</span> <span class="o">=</span> <span class="n">validation</span><span class="o">(</span><span class="n">createParams</span><span class="o">,</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">maxLength</span><span class="o">(</span><span class="mi">512</span><span class="o">),</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">&quot;birthday&quot;</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">dateFormat</span>
  <span class="o">)</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">createParams</span> <span class="o">=</span> <span class="n">Params</span><span class="o">(</span><span class="n">params</span><span class="o">).</span><span class="na">withDate</span><span class="o">(</span><span class="s">&quot;birthday&quot;</span><span class="o">)</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">createFormStrongParameters</span> <span class="o">=</span> <span class="n">Seq</span><span class="o">(</span>
    <span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="n">ParamType</span><span class="o">.</span><span class="na">String</span><span class="o">,</span>
    <span class="s">&quot;birthday&quot;</span> <span class="o">-&gt;</span> <span class="n">ParamType</span><span class="o">.</span><span class="na">LocalDate</span>
  <span class="o">)</span>

  <span class="c1">// parameters &amp; validations for modification</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">updateForm</span> <span class="o">=</span> <span class="n">validation</span><span class="o">(</span><span class="n">updateParams</span><span class="o">,</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">maxLength</span><span class="o">(</span><span class="mi">512</span><span class="o">),</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">&quot;birthday&quot;</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">dateFormat</span>
  <span class="o">)</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">updateParams</span> <span class="o">=</span> <span class="n">Params</span><span class="o">(</span><span class="n">params</span><span class="o">).</span><span class="na">withDate</span><span class="o">(</span><span class="s">&quot;birthday&quot;</span><span class="o">)</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">updateFormStrongParameters</span> <span class="o">=</span> <span class="n">Seq</span><span class="o">(</span>
    <span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="n">ParamType</span><span class="o">.</span><span class="na">String</span><span class="o">,</span>
    <span class="s">&quot;birthday&quot;</span> <span class="o">-&gt;</span> <span class="n">ParamType</span><span class="o">.</span><span class="na">LocalDate</span>
  <span class="o">)</span>

<span class="o">}</span>
</pre>
<p>Required view templates:</p>
<pre class="highlight text">src/main/webapp/WEB-INF/views/members/
├── _form.html.ssp
├── edit.html.ssp
├── index.html.ssp
├── new.html.ssp
└── show.html.ssp
</pre>
<p>In this case, SkinnyResource provides the following URLs by default.</p>

<ul>
<li>GET /members</li>
<li>GET /members/</li>
<li>GET /members.xml</li>
<li>GET /members.json</li>
<li>GET /members/new</li>
<li>POST /members</li>
<li>POST /members/</li>
<li>GET /members/{id}</li>
<li>GET /members/{id}.xml</li>
<li>GET /members/{id}.json</li>
<li>GET /members/{id}/edit</li>
<li>POST /members/{id}</li>
<li>PUT /members/{id}</li>
<li>PATCH /members/{id}</li>
<li>DELETE /members/{id}</li>
</ul>

<hr/>

<h3>skinny.Skinny</h3>

<p>skinny.Skinny provides getters for basic elements in view templates.</p>
<pre class="highlight text">&lt;%@val s: skinny.Skinny %&gt;
</pre>
<p><a href="https://github.com/skinny-framework/skinny-framework/blob/master/framework/src/main/scala/skinny/Skinny.scala">framework/src/main/scala/skinny/Skinny.scala</a></p>

<ul>
<li>params: Params</li>
<li>multiParams: MultiParams</li>
<li>flash: Flash</li>
<li>errorMessages: Seq[String]</li>
<li>keyAndErrorMessages: Map[String, Seq[String]]</li>
<li>contextPath: String</li>
<li>requestPath: String</li>
<li>requestPathWithQueryString: String</li>
<li>csrfKey: String</li>
<li>csrfToken: String</li>
<li>csrfMetaTag(s): String</li>
<li>csrfHiddenInputTag: String</li>
<li>i18n: I18n</li>
</ul>

<hr/>

<h3>How to Do It</h3>

<p>Basically, you will use Scalatra&rsquo;s DSL.</p>

<p><a href="http://www.scalatra.org/2.2/guides/">http://www.scalatra.org/2.2/guides/</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase</a></p>

<h4>(Query/Form/Path) Parameters</h4>

<p><a href="http://www.scalatra.org/guides/http/routes.html">http://www.scalatra.org/guides/http/routes.html</a></p>

<ul>
<li>params</li>
<li>params.get(name)</li>
<li>multiParams(&ldquo;splat&rdquo;)</li>
<li>multiParams(&ldquo;captures&rdquo;)</li>
</ul>

<h4>Cookies</h4>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase</a></p>

<ul>
<li>cookies</li>
</ul>

<h4>Request/Response Headers</h4>

<p><a href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html">http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html</a></p>

<p><a href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletResponse.html">http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletResponse.html</a></p>

<ul>
<li>request.getHeader(name)</li>
<li>response.setHeader(name, value)</li>
</ul>

<h4>Session</h4>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.SessionSupport">http://www.scalatra.org/2.2/api/index.html#org.scalatra.SessionSupport</a></p>

<ul>
<li>session</li>
<li>session(key)</li>
</ul>

<h4>Flash</h4>

<p><a href="http://www.scalatra.org/guides/http/flash.html">http://www.scalatra.org/guides/http/flash.html</a></p>

<ul>
<li>flash(name) = value</li>
<li>flash += (name -> value)</li>
<li>flash.now += (name -> value)</li>
</ul>

<h4>Response handling</h4>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase</a></p>

<ul>
<li>halt(status, body, headers, reason)</li>
</ul>

<h4>Before/After Filters</h4>

<p>Scalatra has filters by default. However, we highly recommend Skinny users to use Skinny&rsquo;s filters.</p>

<h5>Scalatra filters</h5>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase</a></p>

<ul>
<li>before(transformers)(action)</li>
<li>after(transformers)(action)</li>
</ul>

<h5>Skinny filters</h5>

<p><a href="https://github.com/skinny-framework/skinny-framework/blob/master/framework/src/main/scala/skinny/controller/feature/BeforeAfterActionFeature.scala">framework/src/main/scala/skinny/controller/feature/BeforeAfterActionFeature.scala</a></p>
<pre class="highlight java"><span class="kd">class</span> <span class="nc">MembersController</span> <span class="kd">extends</span> <span class="n">SkinnyController</span> <span class="n">with</span> <span class="n">Routes</span> <span class="o">{</span>

  <span class="c1">// Scalatra filters</span>
  <span class="n">before</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span> <span class="c1">// might affect in other controllers</span>
  <span class="n">after</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

  <span class="c1">// Skinny filters</span>
  <span class="n">beforeAction</span><span class="o">(</span><span class="n">only</span> <span class="o">=</span> <span class="n">Seq</span><span class="o">(</span><span class="err">'</span><span class="n">index</span><span class="o">,</span> <span class="err">'</span><span class="k">new</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;before&quot;</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="n">afterAction</span><span class="o">(</span><span class="n">except</span> <span class="o">=</span> <span class="n">Seq</span><span class="o">(</span><span class="err">'</span><span class="k">new</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;after&quot;</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="c1">//actions</span>
  <span class="n">def</span> <span class="n">index</span> <span class="o">=</span> <span class="o">...</span>
  <span class="n">def</span> <span class="n">newInput</span> <span class="o">=</span> <span class="o">...</span>
  <span class="n">def</span> <span class="n">edit</span> <span class="o">=</span> <span class="o">...</span>

  <span class="c1">// routes</span>
  <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/?&quot;</span><span class="o">)(</span><span class="n">index</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">'</span><span class="n">index</span><span class="o">)</span>      <span class="c1">// before, after</span>
  <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/new&quot;</span><span class="o">)(</span><span class="n">newInput</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">'</span><span class="k">new</span><span class="o">)</span>   <span class="c1">// before</span>
  <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/:id/edit&quot;</span><span class="o">)(</span><span class="n">edit</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">'</span><span class="n">edit</span><span class="o">)</span> <span class="c1">// after</span>

<span class="o">}</span>
</pre>
<p>Scalatra&rsquo;s filters might effect other controllers.</p>

<p>If you need filters that are similar to Rails filters, just use Skinny filters.</p>

            <hr/>
            <div class="alert alert-info small"> 
              If this webpage has typo or something wrong, Please report or fix. <a href="/contribution.html">How?</a>
            </div> 
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.0.1/js/bootstrap.min.js"></script>
  </body>
</html>

